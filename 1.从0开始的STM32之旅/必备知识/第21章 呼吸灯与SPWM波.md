# 第二十一章 呼吸灯与SPWM波

## 1. 呼吸灯简介

呼吸灯，就是指灯光设备的亮度随着时间由暗到亮逐渐增强，再由亮到暗逐渐衰减，很有节奏感地一起一伏，就像是在呼吸一样，因而被广泛应用于手机、 电脑等电子设备的指示灯中，冰冷的电子设备应用呼吸灯后，顿时增添了几分温暖。

## 2. 呼吸灯与PWM控制原理

呼吸的特性是一种类似图中的指数曲线过程，吸气是指数上升过程，呼气是指数下降过程，成年人吸气呼气整个过程持续约3秒。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/SPWM002.png)

要控制LED灯达到呼吸灯的效果，实际上就是要控制LED灯的亮度拟合呼吸特性曲线。前面控制全彩LED灯时，通过控制脉冲的占空比来调整各个通道LED灯的亮度， 从而达到混色的效果。若控制脉冲的占空比在3秒的时间周期内按呼吸特性曲线变化，那么就可以实现呼吸灯的效果了。

这种使用脉冲占空比拟合不同波形的方式称为PWM(脉冲宽度调制)控制技术——通过对一系列脉冲的宽度进行调制，来等效地获得所需要波形（含形状和幅值）。 PWM控制的基本原理为：冲量相等而开头不同的窄脉冲加在具有惯性的环节上时，其效果基本相同。其中冲量指窄脉冲的面积；效果相同指环节输出响应波形基本相同。

例如：可以用一系列等幅不用一系列等幅不等宽的脉冲来代替一个正弦半波

- 把正弦半波 N 等分，可看成 N 个彼此相连的脉冲序列，宽度相等，但幅值不等；

- 用矩形脉冲代替，各个矩形脉冲等幅，不等宽，中点重合，脉冲宽度按正弦规律变化，脉冲的总面积（冲量）与正弦半波相等。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/SPWM003.jpeg)

这种脉冲波形被称为SPWM 波形——脉冲宽度按正弦规律变化而和正弦波等效的 PWM 波形。SPWM是一种非常典型的PWM波形，它在数字电路控制中应用非常广泛， 如果使用低通滤波器，可以由SPWM波得到其等效的连续正弦半波。

要改变等效输出正弦波幅值，按同一比例改变各脉冲宽度即可。

若把拟合的波形改成呼吸特性曲线，即可得到控制呼吸灯使用的PWM波形，要生成拟合的PWM波形，通常使用计算法和调制法：

(1) 计算法：根据拟合波形的频率、幅值和半周期脉冲数，准确计算 PWM 波各脉冲宽度和间隔， 据此控制开关器件的通断，就可得到所需PWM波形；

(2) 调制法：拟合波形作调制信号，进行调制得到期望的PWM波；该方法一般采用等腰三角波为载波， 其任一点水平宽度和高度成线性关系且左右对称。载波(等腰三角波)与平缓变化的调制信号波(即要拟合的波形)相交， 在载波与信号波的交点控制器件通断，就得宽度正比于信号波幅值的脉冲，符合PWM的要求。相对于计算法，其处理过程计算简单。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/SPWM004.png)

在本章的各个实验中，演示如何使用计算法得到的呼吸曲线PWM波和SPWM波，并使用STM32定时器TIM的PWM功能输出波形控制LED灯，达到呼吸灯的效果。

---

2024.9.17 第一次修订，后期不再维护
