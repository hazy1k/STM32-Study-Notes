# 第二十九章 电阻触摸屏-触摸画板

## 1. 触摸屏简介

触摸屏又称触控面板，它是一种把触摸位置转化成坐标数据的输入设备，根据触摸屏的检测原理，主要分为电阻式触摸屏和电容式触摸屏。 相对来说，电阻屏造价便宜，能适应较恶劣的环境，但它只支持单点触控(一次只能检测面板上的一个触摸位置)，触摸时需要一定的压力， 使用久了容易造成表面磨损，影响寿命；而电容屏具有支持多点触控、检测精度高的特点，电容屏通过与导电物体产生的电容效应来检测触摸动作， 只能感应导电物体的触摸，湿度较大或屏幕表面有水珠时会影响电容屏的检测效果。

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch002.jpg" title="" alt="" width="429">

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch003.jpg" title="" alt="" width="443">

分别是带电阻触摸屏及电容触摸屏的两种屏幕， 从外观上并没有明显的区别，区分电阻屏与电容屏最直接的方法就是使用绝缘物体点击屏幕，因为电阻屏通过压力能正常检测触摸动作， 而该绝缘物体无法影响电容屏所检测的信号，因而无法检测到触摸动作。目前电容式触摸屏被大部分应用在智能手机、平板电脑等电子设备中， 而在汽车导航、工控机等设备中电阻式触摸屏仍占主流。

## 2. 电阻式触摸屏检测原理

电阻式的触摸屏结构见图 [电阻式触摸屏结构](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#id6) 。它主要由表面硬涂层、两个ITO层、间隔点以及玻璃底层构成， 这些结构层都是透明的，整个触摸屏覆盖在液晶面板上，透过触摸屏可看到液晶面板。表面涂层起到保护作用， 玻璃底层起承载的作用，而两个ITO层是触摸屏的关键结构，它们是涂有铟锡金属氧化物的导电层。 两个ITO层之间使用间隔点使两层分开，当触摸屏表面受到压力时，表面弯曲使得上层ITO与下层ITO接触，在触点处连通电路。

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch004.jpeg" title="" alt="" width="261">

两个ITO涂层的两端分别引出X-、X+、Y-、Y+四个电极，见图 [XY的ITO层结构](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#xyito) ， 这是电阻屏最常见的四线结构，通过这些电极，外部电路向这两个涂层可以施加匀强电场或检测电压。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch005.jpeg)

当触摸屏被按下时，两个ITO层相互接触，从触点处把ITO层分为两个电阻，且由于ITO层均匀导电，两个电阻的大小与触点离两电极的距离成比例关系， 利用这个特性，可通过以下过程来检测坐标，这也正是电阻触摸屏名称的由来，见图 [触摸检测等效电路](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#id7) 。

- 计算X坐标时，在X+电极施加驱动电压V<sub>ref，X-极接地，所以X+与X-处形成了匀强电场，而触点处的电压通过Y+电极采集得到， 由于ITO层均匀导电，触点电压与V<sub>ref之比等于触点X坐标与屏宽度之比。

- 计算Y坐标时，在Y+电极施加驱动电压V<sub>ref，Y-极接地，所以Y+与Y-处形成了匀强电场，而触点处的电压通过X+电极采集得到， 由于ITO层均匀导电，触点电压与V<sub>ref之比等于触点Y坐标与屏高度之比

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch006.jpeg)

## 3. 电阻触摸屏控制芯片

为了方便检测触摸的坐标，一些芯片厂商制作了电阻屏专用的控制芯片，控制上述采集过程、采集电压， 外部微控制器直接与触摸控制芯片通讯直接获得触点的电压或坐标。 如图 [单电阻屏_电阻液晶屏](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#id3) 中我们生产的这款3.2寸电阻触摸屏就是采用XPT2046芯片作为触摸控制芯片 ，XPT2046芯片控制4线电阻触摸屏，STM32与XPT2046采用SPI通讯获取采集得的电压，然后转换成坐标。

XPT2046是专用在四线电阻屏的触摸屏控制器，STM32可通过SPI接口向它写入控制字， 由它测得X、Y方向的触点电压返回给STM32。见图 [TSC2046与电阻屏的连接图](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#tsc2046) 。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch007.png)

图中，电阻屏两层阻性材料的两端分别接入到XPT2046的X+、X-和Y+、Y-。当要测量X坐标时，STM32通过SPI接口写命令到XPT2046， 使它通过内部的模拟开关使X+、X-接通电源，于是在电阻屏的X方向上产生一个匀强电场；把Y+、Y-连接到XPT2046的ADC。当电阻屏被触摸时， 上、下两层的阻性材料接触，在PENIRQ引脚产生一个中断信号，通知STM32。该触点的电压由Y+或Y-(此时的Y+Y-电阻很小，可忽略)引入到ADC进行测量， STM32读取该电压，进行软件转换，就可以测得触点X方向的坐标。同理可以测得Y方向的坐标。

XPT2046输出的ADC电压值是12位的，这也是它型号中2046名称的来源。

## 4. 电容式触摸屏检测原理

与电阻式触摸屏不同，电容式触摸屏不需要通过压力使触点变形，再通过触点处电压值来检测坐标，它的基本原理和前面定时器章节中介绍的电容按键类似， 都是利用充电时间检测电容大小，从而通过检测出电容值的变化来获知触摸信号。见图 [电容触摸屏基本原理](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#id10) ， 电容屏的最上层是玻璃(不会像电阻屏那样形变)，核心层部分也是由ITO材料构成的，这些导电材料在屏幕里构成了人眼看不见的静电网， 静电网由多行X轴电极和多列Y轴电极构成，两个电极之间会形成电容。触摸屏工作时，X轴电极发出AC交流信号，而交流信号能穿过电容， 即通过Y轴能感应出该信号，当交流电穿越时电容会有充放电过程，检测该充电时间可获知电容量。若手指触摸屏幕， 会影响触摸点附近两个电极之间的耦合，从而改变两个电极之间的电容量，若检测到某电容的电容量发生了改变， 即可获知该电容处有触摸动作（这就是为什么它被称为电容式触摸屏以及绝缘体触摸没有反应的原因）。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch008.jpg)

电容屏ITO层的结构见图 [电容触摸屏的ITO层结构](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/book/touch.html#ito) ，这是比较常见的形式，电极由多个菱形导体组成，生产时使用蚀刻工艺在ITO层生成这样的结构。

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch009.jpeg)

X轴电极与Y轴电极在交叉处形成电容，即这两组电极构成了电容的两极，这样的结构覆盖了整个电容屏，每个电容单元在触摸屏中都有其特定的物理位置， 即电容的位置就是它在触摸屏的XY坐标。检测触摸的坐标时，第1条X轴的电极发出激励信号，而所有Y轴的电极同时接收信号， 通过检测充电时间可检测出各个Y轴与第1条X轴相交的各个互电容的大小，各个X轴依次发出激励信号，重复上述步骤，即可得到整个触摸屏二维平面的所有电容大小。 当手指接近时，会导致局部电容改变，根据得到的触摸屏电容量变化的二维数据表，可以得知每个触摸点的坐标，因此电容触摸屏支持多点触控。

其实电容触摸屏可看作是多个电容按键组合而成，就像机械按键中独立按键和矩阵按键的关系一样，甚至电容触摸屏的坐标扫描方式与矩阵按键都是很相似的。
