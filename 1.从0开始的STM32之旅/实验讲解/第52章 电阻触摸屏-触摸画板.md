# 第五十二章 电阻触摸屏-触摸画板

## 1. 硬件设计

### 1.1 液晶实物图

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch010.jpg" title="" alt="" width="688">

### 1.2 屏幕PCB底版

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch011.jpeg" title="" alt="" width="691">

屏幕的PCB底板引出的信号线会通过PCB底板上的FPC接口与液晶面板连接，这些信包括液晶控制相关的CS、RS等信号及DB0-DB15数据线， 其中RS引脚以高电平表示传输数据，低电平表示传输命令；另外还有引出LCD_BK引脚用于控制屏幕的背光供电，可以通过该引脚控制背光的强度， 该引脚为低电平时打开背光。图中的X+/X-/Y+/Y-引脚是液晶面板上触摸屏引出的信号线，它们会被连接到PCB底板的电阻触摸屏控制器， 用于检测触摸信号

### 1.3 屏幕PCB底版的触摸部分原理图

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch012.jpeg)

触摸检测的主体是型号为XPT2046的芯片，它接收触摸屏的X+/X-/Y+/Y-信号进行处理，把触摸信息使用SPI接口输出到STM32等控制器， 注意，由于控制XPT2046芯片的并不是STM32专用的硬件SPI接口，所以在编写程序时，需要使用软件模拟SPI时序与触摸芯片进行通讯。

### 1.4 液晶屏接口

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch013.jpg" title="" alt="" width="633">

图表示的是PCB底板引出的排针线序，屏幕整体通过这些引出的排针与开发板或其它控制器连接。

### 1.5 开发板与屏幕的连接的信号说明

<img src="https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/touch014.jpg" title="" alt="" width="665">

图是霸道开发板上的液晶排母接口原理图， 它说明了配套的3.2寸屏幕接入到开发板上时的信号连接关系。 其中请着重关注图中液晶屏LCD_CS及LCD_RS(即DC引脚)与FSMC存储区选择引脚FSMC_NE及地址信号FSMC_A的编号， 它们会决定STM32要使用什么内存地址来控制与液晶屏的通讯。

## 2. 软件设计

### 2.1 编程目标

1. 编写软件模拟SPI协议的驱动；

2. 编写触摸芯片的控制驱动，如发送命令字，获取触摸坐标等；

3. 编写触摸校正程序；

4. 编写测试程序检验驱动。

### 2.2 代码分析

#### 2.2.1 触摸屏硬件相关宏定义
