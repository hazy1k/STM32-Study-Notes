# 第五十七章 PWR-PVD电源监控实验

## 1. 硬件设计

本实验中使用PVD监控STM32芯片的VDD引脚，当监测到供电电压低于阈值时会产生PVD中断，系统进入中断服务函数进入紧急处理过程。 所以进行这个实验时需要使用一个可调的电压源给实验板供电，改变给STM32芯片的供电电压，为此我们需要先了解实验板的电源供电系统：

![](https://doc.embedfire.com/mcu/stm32/f103zhinanzhe/std/zh/latest/_images/Power005.jpeg)

整个电源供电系统主要分为以下五部分：

(1) 6-12V的DC电源供电系统，这部分使用DC电源接口引入6-12V的电源， 经过RT7272进行电压转换成5V电源，再与第二部分的“5V_USB”电源线连接在一起。

(2) 第二部分使用USB接口，使用USB线从外部引入5V电源， 引入的电源经过电源开关及保险丝连接到“5V”电源线。

(3) 第三部分的是电源开关及保险丝，即当我们的实验板使用DC电源或“5V_USB”线供电时， 可用电源开关控制通断，保险丝也会起保护作用。

(4) “5V”电源线遍布整个板子，板子上各个位置引出的标有“5V”丝印的排针都与这个电源线直接相连。 5V电源线给板子上的某些工作电压为5V的芯片供电。5V电源还经过LDO稳压芯片，输出3.3V电源连接到“3.3V”电源线。

(5) 同样地，“3.3V”电源线也遍布整个板子，各个引出的标有“3.3V”丝印的排针都与它直接相连， 3.3V电源给工作电压为3.3V的各种芯片供电。STM32芯片的VDD引脚就是直接与这个3.3V电源相连的，所以通过STM32的PVD监控的就是这个“3.3V”电源线的电压。

当我们进行这个PVD实验时，为方便改变“3.3V”电源线的电压，我们可以把可调电源通过实验板上引出的“5V”及“GND” 排针给实验板供电， 当可调电源电压降低时，LDO在“3.3V”电源线的供电电压会随之降低，即STM32的PVD监控的VDD引脚电压会降低， 这样我们就可以模拟VDD电压下降的实验条件，对PVD进行测试了。不过，由于这样供电不经过保险丝， 所以在调节电压的时候要小心，不要给它供电远高于5V，否则可能会烧坏实验板上的芯片。

## 2. 软件设计

### 2.1 编程目标

- 初始化PVD中断；

- 设置PVD电压监控等级并使能PVD；

- 编写PVD中断服务函数，处理紧急任务。


