/*********************************************************************************************/

【*】程序简介

-工程名称：通用定时器-输入捕获-测量脉冲宽度
-实验平台: 野火STM32 指南者 开发板 
-ST固件库版本：3.5

【 ！】功能简介：
使用STM32的通用控制定时器输入捕获，在开发板中 PA0 接的是一个按键，默认接 GND，当按键按下的时候 IO 口会被拉高
，这个时候我们可以利用定时器的输入捕获功能来测量按键按下的这段高电平的时间
学习目的：学会使用通用控制定时器输入捕获测量脉宽

【 ！】实验操作：
电脑端使用串口调试助手，选择电脑与STM32相连的COM口，设置为115200-N-8-1，
按下K1按键，电脑的串口助手就会打印按键按下的时间

/*********************************************************************************************/

【*】 引脚分配


串口(TTL-USB TO USART)：
CH340的收发引脚与STM32的发收引脚相连。
	CH340  RXD  <----->  USART1  TX  (PA9)
	CH340  TXD  <----->  USART1  RX  (PA10)

开发板的按键与STM32引脚相连
	K1<--->PA0


【*】程序描述

	<bsp_GeneralTim.c>
		
		(1) 定时器用到的GPIO初始化 
		(2) 定时器时基结构体 TIM_TimeBaseInitTypeDef初始化
		(3) 定时器输入捕获结构体 TIM_ICInitTypeDef初始化 
		(4) 编写中断服务函数，读取捕获值，计算出脉宽的时间
	
在初始化时基结构体的周期和时钟分频因子这两个成员时，我们使用了两个宏 GENERAL_TIM_PERIOD 和 GENERAL_TIM_PSC。
GENERAL_TIM_PERIOD 配置的是 ARR 寄存器的值，决定了计数器一个周期的计数时间，默认我们配置为 0XFFFF，即最大。
GENERAL_TIM_PSC 配置的是分频因子，默认配置为 72-1，则可以计算出计数器的计数周期为(GENERAL_TIM_PSC+1)/72M = 1US。
所以输入捕获能捕获的最小的时间为 1us，最长的时间为 1us*(0Xffff+1)=65536us=65.536ms，
当超过这个计数周期的时候，就会产生中断，然后在中断里面做额外的处理，需要记录好产生了多少次更新中断，
最后把这个更新时间加入到脉宽的时间里面。

	PS:由于我们按键在物理设计上存在物理消抖（并联电容），断开后需要一会时间电平才会变成零，
	所以导致测量时间会比实际时间长一点，如需测量准确时间可另选其他引脚操作，本例程只是提供一个思想实现
	
/*********************************************************************************************/

【*】 联系我们

-野火官网  :https://embedfire.com
-野火论坛  :http://www.firebbs.cn
-野火商城  :https://yehuosm.tmall.com/
-野火资料下载中心 :http://doc.embedfire.com/products/link

/*********************************************************************************************/