/*********************************************************************************************/
本文档使用 TAB = 4 对齐，使用keil5默认配置打开阅读比较方便。

【*】程序简介

-工程名称：LCD显示BMP文件及截图
-实验平台: 野火STM32 指南者 开发板 
-MDK版本：5.16
-ST固件库版本：3.5

【 ！】功能简介：
驱动3.2_2.8寸液晶屏，显示BMP文件及截图

【 ！】实验操作：
连接好配套的3.2_2.8寸液晶屏，给实验板插入带实验文件的SD卡，下载程序后复位开发板即可，
按下KEY1按键可截图，截图时亮蓝灯，亮绿灯时表示截图完成，亮红灯时表示截图失败，须等待截图完成后再进行其它操作。

【*】注意事项：
本程序显示的是SD卡内的图片，截图也是保存到SD卡，
实验前需要把本工程目录下的“需放SD卡文件”文件夹的内容拷贝到SD卡的根目录。
截图会被保存到SD卡，截图后拔下SD卡，使用读卡器在电脑上查看
2.8寸 屏幕芯片：ILI9341
3.2寸 屏幕芯片：ST7789V（现在生产使用）
开发板配套程序里已做兼容ILI9341和ST7789V（例程中的 LCD 函数仍以 ILI9341 为前缀命名）
高型号 STM32（如 STM32VET6/STM32ZET6 等）具有 FSMC 外设，直接使用 FSMC 接口实现 8080 时序
定义一个指向这些地址的指针，然后就可以通过指针直接修改该存储单元的内容，
FSMC 外设会自动完成数据访问过程，读写命令之类的操作不需要程序控制。

【*】显示自己的图片：
需要将24位真彩色BMP文件格式的图片拷贝到SD卡的根目录，图片的分辨率不能超过对应屏幕的分辨率
然后在主函数调用函数 LCD_Show_BMP 来显示该图片
比如：LCD_Show_BMP(0, 0, "0:mypicture.bmp");

白屏条纹问题：
若是发现显示白屏的时候屏幕有明显条纹，可更改液晶屏内部的 Power control A (CBh) 寄存器的第5个参数，
将该参数的值改到最大0x06，就不会有白屏条纹了。程序里已默认改为最大0x06。

/***************************************************************************************************************/

【*】 引脚分配

液晶屏：
液晶屏接口与STM32的FSMC接口相连，支持565格式，
使用FSMC产生8080时序与液晶屏驱动芯片ILI9341通讯.

		/*液晶控制信号线*/
		ILI9341_CS 	<--->	PD7      	//片选，选择NOR/SRAM块 BANK1_NOR/SRAM1
		ILI9341_DC  <---> 	PD11		//PD11为FSMC_A16,本引脚决定了访问LCD时使用的地址
		ILI9341_WR 	<---> 	PD5			//写使能
		ILI9341_RD  <---> 	PD4			//读使能
		ILI9341_RST	<---> 	PE1			//复位引脚
		ILI9341_BK 	<---> 	PD12 		//背光引脚
		
	数据信号线省略,本实验没有驱动触摸屏，详看触摸画板实验。

SDIO(microSD卡座，支持32G以内的SD卡)：
microtSD卡座的SDIO接口与STM32的SDIO相连。
		SDIO_D0	<--->PC8
		SDIO_D1	<--->PC9
		SDIO_D2	<--->PC10
		SDIO_D3	<--->PC11
		SDIO_CK	<--->PC12
		SDIO_CMD<--->PD2
        
按键：
	KEY1<--->PA0
				开始时，按键未按下时处于低电平状态
	KEY2<--->PC13
	
LED：
	LED_R<-----> PB5
	LED_G<-----> PB0
	LED_B<-----> PB1  对应引脚低电平则LED灯亮
    
串口(TTL-USB TO USART)：
CH340的收发引脚与STM32的发收引脚相连。
	CH340  RXD  <----->  USART1  TX  (PA9)
	CH340  TXD  <----->  USART1  RX  (PA10)
	
【*】程序相关

    显示BMP图片的函数LCD_Show_BMP ( uint16_t x, uint16_t y, char * pic_name )
    此函数使用给定的参数x和y作为BMP图片在液晶屏上的起始位置，pic_name作为BMP图片文件名。
    使用FatFs库的f_open函数打开BMP图片文件。
    定义变量bitHead和bitInfoHead，用于存储BMP文件头和信息头的数据。
    定义变量fileType用于存储文件类型。
    定义变量read_num用于存储读取的字节数。
    检查BMP文件是否成功打开，如果打开失败则返回。
    获取BMP图片的宽度、高度和每行的字节数。
    检查每行字节数是否超过液晶屏宽度的限制，如果超过则返回。
    在液晶屏上打开指定区域的窗口，以准备显示BMP图片。
    发送命令给液晶屏，告诉它将要写入像素数据。
    如果BMP文件是24位真彩色的，按行读取BMP文件中的像素数据。
    将读取的RGB24格式的像素数据转换为RGB16格式，并通过ILI9341_Write_Data函数将像素数据写入液晶屏GRAM（图形RAM）中。

    屏幕截图函数Screen_Shot( uint16_t x, uint16_t y, uint16_t Width, uint16_t Height, char * filename)
    首先，代码使用给定的参数x、y、Width和Height来计算BMP文件的大小，并初始化BMP文件头数据。
    代码创建或打开BMP文件，写入BMP文件头数据。
    接下来，代码使用嵌套的循环遍历每个像素，通过调用ILI9341_GetPointPixel函数获取液晶屏上的像素数据
    ，并将RGB颜色分量提取出来。将RGB颜色分量依次写入BMP文件。
    在内层循环中，还对行数据进行了对齐操作，以满足BMP文件的4字节对齐要求。
    最后，代码关闭BMP文件，并根据操作结果返回相应的结果码。
    
/*********************************************************************************************/

【*】 版本

-程序版本：1.0
-发布日期：2013-10

/*********************************************************************************************/

【*】 联系我们

-野火官网  :https://embedfire.com
-野火论坛  :http://www.firebbs.cn
-野火商城  :https://yehuosm.tmall.com/
-野火资料下载中心 :http://doc.embedfire.com/products/link

/*********************************************************************************************/